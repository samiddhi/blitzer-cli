#+TITLE: Creating a Language Pack for Blitzer CLI
#+AUTHOR: Blitzer Team
#+OPTIONS: toc:nil num:nil

This guide explains how to create a downloadable language pack for Blitzer CLI. Language packs are separate Python packages that can be installed via pip and integrate with the Blitzer CLI through a plugin architecture.

* Overview

A language pack is a Python package with the naming convention =blitzer-language-[lang-code]= that:
1. Provides a =register()= function that returns language configuration
2. Defines an entry point that Blitzer CLI can discover
3. Optionally includes data files like lexicon databases
4. Can be distributed as a pip-installable package

* Prerequisites

- Python 3.7+
- Basic knowledge of Python packaging
- Understanding of your target language's linguistic features (tokenization, lemmatization, etc.)

* Step-by-Step Guide

** Step 1: Create Project Structure

Create a directory for your language pack with the following structure:

#+BEGIN_EXAMPLE
blitzer-language-[lang-code]/
├── setup.py (or pyproject.toml)
├── blitzer_language_[lang-code]/
│   ├── __init__.py
│   └── [optional_data_files.db]
└── README.md
#+END_EXAMPLE

For example, for a French language pack:
#+BEGIN_EXAMPLE
blitzer-language-fra/
├── setup.py
├── blitzer_language_fra/
│   ├── __init__.py
│   └── fra_lexicon.db
└── README.md
#+END_EXAMPLE

** Step 2: Implement the Language Configuration

Create your =__init__.py= file with a =register()= function that returns language configuration:

#+BEGIN_SRC python
"""[Language Name] language plugin for blitzer."""

import re
from pathlib import Path


def normalizer_func(text: str) -> str:
    """
    Normalize [language name] notation to ensure exclusion list and text are not mismatched.
    """
    # Implement normalization specific to your language
    # This might include handling diacritics, special characters, etc.
    return text.lower()


def tokenizer_func(text: str) -> list[str]:
    """
    Tokenize text according to [language name] rules.
    """
    # [Language Name] specific tokenization
    # Handle special characters, diacritics, etc.
    # For advanced Unicode support, you can use the 'regex' library:
    # import regex
    # tokens = regex.findall(r"\p{L}+(?:[\p{M}\p{N}'\-]+\p{L}+)*", text.lower())
    # Or use the standard 're' library for simpler installation:
    import re
    tokens = re.findall(r"[a-zA-Z]+(?:[a-zA-Z0-9'\-]*[a-zA-Z]+)?", text.lower())
    return tokens


def lemmatizer_func(tokens: list[str]) -> list[str]:
    """
    Custom lemmatizer function for [language name].
    """
    # Implement custom lemmatization logic
    # This is an alternative to using the SQL-based lemmatizer
    # If using SQL-based lemmatization (with database), this can return the tokens as-is
    # or implement your own mapping logic
    return tokens


def register():
    """Register function that returns language configuration."""
    # Get the path to your bundled database file
    db_path = str(Path(__file__).parent / "lemmas.db")
    
    return {
        "db_path": db_path,  # Path to SQLite database for lemmatization (optional)
        "normalizer": normalizer_func,  # Function to normalize text (optional, can be None)
        "tokenizer": tokenizer_func,  # Function to tokenize text (optional, can be None)
        "custom_lemmatizer": lemmatizer_func  # Custom lemmatization function (optional, can be None)
    }
#+END_SRC

** Step 3: Create setup.py or pyproject.toml

*** Option A: Using setup.py

#+BEGIN_SRC python
from setuptools import setup, find_packages

setup(
    name="blitzer-language-[lang-code]",
    version="0.1.0",
    description="[Language Name] language pack for Blitzer CLI",
    author="[Your Name]",
    author_email="[your.email@example.com]",
    packages=find_packages(),
    package_data={
        '[package_name]': ['*.db'],  # Include database files
    },
    include_package_data=True,
    install_requires=[
        "blitzer-cli",  # This ensures compatibility
    ],
    entry_points={
        'blitzer.languages': [
            '[lang-code] = [package_name]:register',
        ]
    },
    python_requires='>=3.7',
    classifiers=[
        "Programming Language :: Python :: 3",
        "License :: OSI Approved :: MIT License",
        "Operating System :: OS Independent",
    ],
)
#+END_SRC

*** Option B: Using pyproject.toml

#+BEGIN_SRC toml
[build-system]
requires = ["setuptools>=45", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "blitzer-language-[lang-code]"
version = "0.1.0"
description = "[Language Name] language pack for Blitzer CLI"
authors = [{name = "[Your Name]", email = "[your.email@example.com]"}]
license = {text = "MIT"}
requires-python = ">=3.7"
dependencies = [
    "blitzer-cli",
]

[project.entry-points."blitzer.languages"]
[lang-code] = "[package_name]:register"

[tool.setuptools.package-data]
[package_name] = ["*.db"]
#+END_SRC

** Step 4: Prepare Your Database (Optional)

If your language supports lemmatization, create a SQLite database with appropriate tables. The database format should be compatible with the core lemmatizer which expects:

- =Forms= table: Maps word forms to lemma IDs (with column =form_representation=)
- =Lemmas= table: Contains lemma information (with column =id= and =lemma=)

Your database should be packaged with your language pack and accessed from within the installed package.

** Step 5: Test Your Language Pack

1. Install your language pack in development mode:
   #+BEGIN_SRC sh
   pip install -e .
   #+END_SRC

2. Test that it's recognized by Blitzer CLI:
   #+BEGIN_SRC sh
   blitzer languages list
   #+END_SRC

3. Test basic functionality:
   #+BEGIN_SRC sh
   echo "Your test text here" | blitzer blitz -l [lang-code]
   #+END_SRC

4. Test with lemmatization if applicable:
   #+BEGIN_SRC sh
   echo "Your test text here" | blitzer blitz -l [lang-code] --lemmatize
   #+END_SRC

** Step 6: Distribute Your Language Pack

Once tested, you can distribute your language pack:

1. Build the package:
   #+BEGIN_SRC sh
   python -m build
   #+END_SRC

2. Upload to PyPI:
   #+BEGIN_SRC sh
   python -m twine upload dist/*
   #+END_SRC

Or simply provide the source code for others to install directly:
#+BEGIN_SRC sh
pip install git+https://github.com/yourusername/blitzer-language-[lang-code].git
#+END_SRC

* Example Language Pack

See the example language packs in the =example_plugins= directory which demonstrate the complete structure:

- =blitzer_language_pali=: Pali language plugin with normalization function and bundled database
- =blitzer_language_slovenian=: Slovenian language plugin with bundled database

* Entry Point Requirements

Your language pack must register an entry point under the group =blitzer.languages= with:
- Name: The language code (e.g., "fra", "spa", "deu")
- Value: The import path to your =register= function

* Configuration Options

Your =register()= function must return a dictionary with the following keys:

- =db_path=: Path to SQLite database for SQL-based lemmatization (can be None)
- =normalizer=: Function to normalize text (can be None for default normalization) 
- =tokenizer=: Function to tokenize text (can be None for default regex tokenizer)
- =custom_lemmatizer=: Custom function to lemmatize tokens (optional, takes list of tokens and returns lemmatized tokens; if provided, it takes precedence over SQL-based lemmatization even if db_path is set)

* Optional Enhancements

Consider adding:
- Comprehensive exclusion lists
- Advanced tokenization rules using the regex library
- Multiple database files for different aspects
- Language-specific configuration options
- Documentation and examples

* Troubleshooting

If your language pack doesn't appear in =blitzer languages list=:
1. Verify the entry point is correctly defined in setup.py/pyproject.toml
2. Check that your package depends on =blitzer-cli=
3. Make sure the =register= function exists and is importable
4. Confirm proper installation with =pip list | grep blitzer-language=

If lemmatization doesn't work:
1. Verify database file is properly packaged and accessible
2. Check database schema matches the expected format (Forms and Lemmas tables)
3. Ensure proper column names in SQL queries (form_representation in Forms, id and lemma in Lemmas)
4. Test database connection and queries independently
